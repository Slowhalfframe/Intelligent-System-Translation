{% extends 'base.html' %}
{% block title_name %}
工作主页
{% endblock %}
{%  block nav %}
<!-- 导航开始 -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--<a class="navbar-brand" href="/work/">人机共译系统</a>-->
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="/work/">主页 <span class="sr-only">(current)</span></a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                {% if user.username %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">{{request.user}} <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/users/{{request.user.id}}/user_info/">个人主页</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/users/user_logout/">安全退出</a></li>
                    </ul>
                </li>

                {% else %}
                <li><a href="{% url 'users:register' %}">注册</a></li>
                <li><a href="{% url 'users:sign_in' %}">登录</a></li>
                {% endif %}
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<!-- 导航结束 -->
{% endblock %}
{% block main %}
{% load static %}
<link rel="stylesheet" href="{% static 'work/css/app/index.css' %}">
<link rel="stylesheet" href="{% static 'work/css/app/trans_type.css' %}">
<style>
    .loader5 {
        display:inline-block;
        width: 0;
        height:0;
        border-left: 25px solid transparent;
        border-right: 25px solid transparent;
        border-bottom: 39px solid #4183D7;
        border-top: 39px solid #F5AB35;
        -webkit-animation: loader5 1.2s ease-in-out infinite alternate;
        animation: loader5 1.2s ease-in-out infinite alternate;
    }
    .l-box{
        width: 55px;
        height: 88px;
        margin: 20% auto;
    }

    @keyframes loader5 {
        from {transform: rotate(0deg);}
        to {transform: rotate(720deg);}
    }
    @-webkit-keyframes loader5 {
        from {-webkit-transform: rotate(0deg);}
        to {-webkit-transform: rotate(720deg);}
    }
    .big_box{
        width: 33%;
        height: 300px;
        /*border: 1px solid #0f0f0f;*/
        margin:6%  auto;
    }
    #btn{
        display: block;
    }
    #tips{
        display: none;
        background: #e1e2e3;
        position:absolute;
        z-Index:10;
        width:500px;
        height:100px;
        left:50%;
        top:50%;
        margin:-50px 0 0 -250px;
        border-radius: 20px;
        box-shadow: 10px 10px 5px #888888;
        border:1px solid #003366;
    }
    #tips h2{
        line-height: 50px;
        text-align: center;
        display: inline-block;
        margin-left: 5%;
    }
    #tips img{
        display: inline-block;
        margin-left: 25%;
    }
</style>
<main style="background-color: #f1f1f1;">
    <div class="box">
        <div class="top"></div>
        <input id="file_id" value="{{file.id}}" hidden>
        <div class="big_box">
            <h3 class="text-center">文件名称：{{file.file_name}}</h3>
            <div class="progress">
                <div id="progress" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="40"
                     aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                <span id="progress_num">0</span>
                </div>
            </div>
            <div class="l-box">
                <div class="loader5"></div>
            </div>
            <h5 class="text-center" id="by">正在编译...</h5>
            <h3 class="text-center" id="hou"><small>请稍候... </small></h3>
            <a class="btn btn-default text-center" id="btn" disabled="true">开始人工编译</a>
            <p class="text-center" id="corpus_matching_count"></p>
        </div>
    </div>
</main>
<div id="tips">
    <img src="/static/zhangsheng.png" alt="">
    <h2>预翻译完成</h2>
</div>
<input type="text" id="type" value="{{type}}" hidden>
<script src="{% static 'js/lib/jquery.js' %}"></script>
<script>
    function random(lower, upper) {
        return Math.floor(Math.random() * (upper - lower)) + lower;
    }
    $(document).ready(function(){
        var file_id = $("#file_id").val();
        $.ajax({
            url: '/work/get_all_par/?id='+file_id,
            method:'POST',
            dataType:'json',
            data:{"csrfmiddlewaretoken": "{{ csrf_token }}"},
            success:function (data) {
                console.log(data.data);
                var all = data.data;
                var all = parseInt(all);
                if(100 < all < 1000){
                    all = all*0.5+all+400
                }else if(all<100){
                    all = all*0.9+all+600
                }else if(all>1000){

                }
                var num = 0;
                var sitv = setInterval(function(){
                if(num >= 100){
                    num = 100;
                    clearInterval(sitv);
                    $('#tips').show ().delay (2000).fadeOut ();
                    $("#btn").addClass("btn btn-info");
                    type = $("#type").val();
                    url = "/work/work/?id="+file_id+"&type="+type;
                    console.log(url);
                    $("#btn").attr('href',url);
                    $("#btn").removeAttr('disabled');
                    $("#by").text("");
                    $("#hou").text("")
                }
                var random_num = random(5,15);
                $('#progress').width(num + '%');
                $('#progress_num').html(num + '%');
                num+=random_num;
            }, all);
            }
        })
    });

    $(document).ready(function () {
        file_id = $("#file_id").val();
        $.ajax({
            url: '/work/red_translation/'+file_id+'/',
            method:'POST',
            dataType:'json',
            data:{"csrfmiddlewaretoken": "{{ csrf_token }}"},
            success:function (data) {
                console.log(data)
            }
        })
    })
</script>
{% endblock %}